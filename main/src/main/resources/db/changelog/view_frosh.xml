<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">
    <changeSet author="Reza Mazloom" id="reza_005">
        <createView viewName="VIEW_FROSH">
            <![CDATA[
select tzn_date,p.id,p.namefa plant,m.gdscode,m.gdsname
				 , case when instr(carname ,'انتينر')>0   then 'ريلی' else 'جاده اي' end car,
				 nvl(sum(wazn),0) wazn,sum(case when tedad is null then 1 when tedad=0 then 1 else tedad end) tedad
				 from v_tozine_content_m m
				join tbl_tozin_target s on s.targetid=sourceid
				join tbl_tozin_plant p on p.id=substr(TOZINE_ID,1,1)
				join tbl_tozin_material mt on mt.gdscode=m.gdscode
				where  m.targetid not in (select targetid from tbl_tozin_target)
				group by tzn_date,p.id,p.namefa ,m.gdscode,m.gdsname
				 , (case when instr(carname ,'انتينر')>0   then 'ريلی' else 'جاده اي' end)
				 order by tzn_date,p.id,m.gdscode
			]]>
        </createView>
    </changeSet>
</databaseChangeLog>
